{"version":3,"file":"legacy-client.js","sourceRoot":"","sources":["../../../src/lib/_legacy/legacy-client.ts"],"names":[],"mappings":"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","sourcesContent":["import { BaseProtoMessage, ProtoMessageFetchResult, WebcastControlMessage } from '@/types/tiktok-schema';\r\nimport { EventEmitter } from 'node:events';\r\nimport { simplifyObject } from '@/lib/_legacy/data-converter';\r\nimport { TikTokLiveConnection } from '@/lib';\r\nimport { ControlEvent, WebcastEvent } from '@/types/events';\r\nimport { WebcastEventMessage } from '@/types';\r\n\r\n/**\r\n * The legacy WebcastPushConnection class for backwards compatibility.\r\n * @deprecated Use TikTokLiveConnection instead.\r\n */\r\nexport class WebcastPushConnection extends (TikTokLiveConnection as new (...args: any[]) => EventEmitter & TikTokLiveConnection) {\r\n\r\n    protected async processProtoMessageFetchResult(fetchResult: ProtoMessageFetchResult): Promise<void> {\r\n\r\n        fetchResult.messages.forEach((message) => {\r\n            this.emit(ControlEvent.RAW_DATA, message.type, message.payload);\r\n        });\r\n\r\n        // Process and emit decoded data depending on the message type\r\n        fetchResult.messages\r\n            .forEach((message: BaseProtoMessage) => {\r\n                let simplifiedObj = simplifyObject(message.type as keyof WebcastEventMessage, message.decodedData?.data || {});\r\n                this.emit(ControlEvent.DECODED_DATA, message.type, simplifiedObj, message.payload);\r\n\r\n                switch (message.type) {\r\n                    case 'WebcastControlMessage':\r\n                        // Known control actions:\r\n                        // 3 = Stream terminated by user\r\n                        // 4 = Stream terminated by platform moderator (ban)\r\n                        const action = (message.decodedData.data as WebcastControlMessage).action;\r\n                        if ([3, 4].includes(action)) {\r\n                            this.emit(WebcastEvent.STREAM_END, { action });\r\n                            this.disconnect();\r\n                        }\r\n                        break;\r\n                    case 'WebcastRoomUserSeqMessage':\r\n                        this.emit(WebcastEvent.ROOM_USER, simplifiedObj);\r\n                        break;\r\n                    case 'WebcastChatMessage':\r\n                        this.emit(WebcastEvent.CHAT, simplifiedObj);\r\n                        break;\r\n                    case 'WebcastMemberMessage':\r\n                        this.emit(WebcastEvent.MEMBER, simplifiedObj);\r\n                        break;\r\n                    case 'WebcastGiftMessage':\r\n                        // Add extended gift info if option enabled\r\n                        if (Array.isArray(this.availableGifts) && simplifiedObj.giftId) {\r\n                            simplifiedObj.extendedGiftInfo = this.availableGifts.find((x) => x.id === simplifiedObj.giftId);\r\n                        }\r\n                        this.emit(WebcastEvent.GIFT, simplifiedObj);\r\n                        break;\r\n                    case 'WebcastSocialMessage':\r\n                        this.emit(WebcastEvent.SOCIAL, simplifiedObj);\r\n                        if (simplifiedObj.displayType?.includes('follow')) {\r\n                            this.emit(WebcastEvent.FOLLOW, simplifiedObj);\r\n                        }\r\n                        if (simplifiedObj.displayType?.includes('share')) {\r\n                            this.emit(WebcastEvent.SHARE, simplifiedObj);\r\n                        }\r\n                        break;\r\n                    case 'WebcastLikeMessage':\r\n                        this.emit(WebcastEvent.LIKE, simplifiedObj);\r\n                        break;\r\n                    case 'WebcastQuestionNewMessage':\r\n                        this.emit(WebcastEvent.QUESTION_NEW, simplifiedObj);\r\n                        break;\r\n                    case 'WebcastLinkMicBattle':\r\n                        this.emit(WebcastEvent.LINK_MIC_BATTLE, simplifiedObj);\r\n                        break;\r\n                    case 'WebcastLinkMicArmies':\r\n                        this.emit(WebcastEvent.LINK_MIC_ARMIES, simplifiedObj);\r\n                        break;\r\n                    case 'WebcastLiveIntroMessage':\r\n                        this.emit(WebcastEvent.LIVE_INTRO, simplifiedObj);\r\n                        break;\r\n                    case 'WebcastEmoteChatMessage':\r\n                        this.emit(WebcastEvent.EMOTE, simplifiedObj);\r\n                        break;\r\n                    case 'WebcastEnvelopeMessage':\r\n                        this.emit(WebcastEvent.ENVELOPE, simplifiedObj);\r\n                        break;\r\n                    case 'WebcastSubNotifyMessage':\r\n                        this.emit(WebcastEvent.SUBSCRIBE, simplifiedObj);\r\n                        break;\r\n                }\r\n            });\r\n    }\r\n\r\n\r\n}\r\n\r\n"]}