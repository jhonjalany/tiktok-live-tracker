{"version":3,"file":"data-converter.js","sourceRoot":"","sources":["../../../src/lib/_legacy/data-converter.ts"],"names":[],"mappings":";;;AAeA;;;;GAIG;AACH,SAAgB,cAAc,CAC1B,IAA+B,EAC/B,cAAmB;IAGnB,8CAA8C;IAC9C,MAAM,QAAQ,GAAG,CAAgB,EAA4C,EAA2B,EAAE,CAAC,EAAE,CAAC,cAAmB,CAAC,CAAC;IAEnI,IAAI,cAAc,CAAC,IAAI,EAAE;QACrB,cAAc,GAAG,QAAQ,CAAiB,CAAC,aAAa,EAAE,EAAE;YACxD,MAAM,CAAC,MAAM,CAAC,aAAa,EAAE,iBAAiB,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC;YACpE,OAAO,aAAa,CAAC,IAAI,CAAC;YAC1B,OAAO,aAAa,CAAC;QACzB,CAAC,CAAC,CAAC;KACN;IAED,IAAI,cAAc,CAAC,MAAM,EAAE;QACvB,cAAc,GAAG,QAAQ,CAAgC,CAAC,aAAa,EAAE,EAAE;YACvE,MAAM,CAAC,MAAM,CAAC,aAAa,EAAE,aAAa,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC;YAC/D,OAAO,aAAa,CAAC,MAAM,CAAC,WAAW,CAAC;YACxC,MAAM,CAAC,MAAM,CAAC,aAAa,EAAE,aAAa,CAAC,MAAM,CAAC,CAAC;YACnD,OAAO,aAAa,CAAC,MAAM,CAAC;YAC5B,OAAO,aAAa,CAAC;QACzB,CAAC,CAAC,CAAC;KACN;IAED,QAAQ,IAAI,EAAE;QACV,KAAK,2BAA2B,CAAC,CAAC;YAC9B,cAAc,GAAG,QAAQ,CAA4B,CAAC,aAAa,EAAE,EAAE;gBACnE,MAAM,CAAC,MAAM,CAAC,aAAa,EAAE,aAAa,CAAC,OAAO,CAAC,CAAC;gBACpD,OAAO,aAAa,CAAC,OAAO,CAAC;gBAC7B,OAAO,aAAa,CAAC;YACzB,CAAC,CAAC,CAAC;YACH,MAAM;SACT;QACD,KAAK,2BAA2B,CAAC,CAAC;YAC9B,cAAc,GAAG,QAAQ,CAA4B,CAAC,aAAa,EAAE,EAAE;gBACnE,aAAa,CAAC,UAAU,GAAG,sBAAsB,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC;gBAC3E,OAAO,aAAa,CAAC,SAAS,CAAC;gBAC/B,OAAO,aAAa,CAAC;YACzB,CAAC,CAAC,CAAC;YACH,MAAM;SACT;QACD,KAAK,sBAAsB,CAAC,CAAC;YACzB,cAAc,GAAG,QAAQ,CAAuB,CAAC,aAAa,EAAE,EAAE;gBAC9D,MAAM,WAAW,GAAG,EAAE,CAAC;gBAEvB,MAAM,CAAC,MAAM,CAAC,aAAa,CAAC,UAAU,CAAC,CAAC,OAAO,CAAC,CAAC,MAAM,EAAE,EAAE;oBACvD,IAAI,MAAM,CAAC,IAAI,EAAE;wBACb,WAAW,CAAC,IAAI,CAAC,iBAAiB,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;qBACpD;gBACL,CAAC,CAAC,CAAC;gBAEH,aAAa,CAAC,WAAW,GAAG,WAAW,CAAC;gBACxC,OAAO,aAAa,CAAC;YACzB,CAAC,CAAC,CAAC;YACH,MAAM;SACT;QACD,KAAK,oBAAoB,CAAC,CAAC;YACvB,cAAc,GAAG,QAAQ,CAA0C,CAAC,aAAa,EAAE,EAAE;gBACjF,aAAa,CAAC,SAAS,GAAG,CAAC,CAAC,aAAa,CAAC,SAAS,CAAC;gBAEpD,iEAAiE;gBACjE,2CAA2C;gBAC3C,aAAa,CAAC,IAAI,GAAG;oBACjB,OAAO,EAAE,aAAa,CAAC,MAAM;oBAC7B,YAAY,EAAE,aAAa,CAAC,WAAW;oBACvC,UAAU,EAAE,aAAa,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC3C,SAAS,EAAE,aAAa,CAAC,WAAW,EAAE,QAAQ;iBACjD,CAAC;gBAEF,IAAI,aAAa,CAAC,WAAW,EAAE;oBAC3B,MAAM,CAAC,MAAM,CAAC,aAAa,EAAE,aAAa,CAAC,WAAW,CAAC,CAAC;oBACxD,OAAO,aAAa,CAAC,WAAW,CAAC;iBACpC;gBAED,IAAI,aAAa,CAAC,WAAW,CAAC,SAAS,EAAE;oBACrC,MAAM,CAAC,MAAM,CAAC,aAAa,EAAE,aAAa,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC;oBAClE,OAAO,aAAa,CAAC,WAAW,CAAC,SAAS,CAAC;iBAC9C;gBAED,IAAI,aAAa,CAAC,SAAS,EAAE;oBAEzB,IAAI,aAAa,CAAC,SAAS,CAAC,QAAQ,EAAE;wBAClC,aAAa,CAAC,cAAc,GAAG,aAAa,CAAC,SAAS,CAAC,QAAQ,CAAC;wBAChE,OAAO,aAAa,CAAC,SAAS,CAAC,QAAQ,CAAC;qBAC3C;oBAED,IAAI,aAAa,CAAC,SAAS,CAAC,4BAA4B,EAAE;wBACtD,aAAa,CAAC,SAAS,GAAG,QAAQ,CAAC,aAAa,CAAC,SAAS,CAAC,4BAA4B,CAAC,CAAC;wBACzF,OAAO,aAAa,CAAC,SAAS,CAAC,4BAA4B,CAAC;qBAC/D;oBAED,MAAM,CAAC,MAAM,CAAC,aAAa,EAAE,aAAa,CAAC,SAAS,CAAC,CAAC;oBACtD,OAAO,aAAa,CAAC,SAAS,CAAC;iBAClC;gBAED,IAAI,aAAa,CAAC,YAAY,EAAE,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE;oBAChD,IAAI;wBACA,aAAa,CAAC,YAAY,GAAG,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,YAAY,CAAC,CAAC;qBACvE;oBAAC,OAAO,GAAG,EAAE;qBACb;iBACJ;gBAED,OAAO,aAAa,CAAC;YACzB,CAAC,CAAC,CAAC;YACH,MAAM;SACT;QACD,KAAK,oBAAoB,CAAC,CAAC;YACvB,cAAc,GAAG,QAAQ,CAAyD,CAAC,aAAa,EAAE,EAAE;gBAChG,aAAa,CAAC,MAAM,GAAG,aAAa,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,KAAsB,EAAE,EAAE,CAAC,CACxE;oBACI,OAAO,EAAE,KAAK,CAAC,KAAK,CAAC,OAAO;oBAC5B,aAAa,EAAE,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,QAAQ;oBACzC,cAAc,EAAE,KAAK,CAAC,cAAc;iBACvC,CACJ,CAAC,CAAC;gBACH,OAAO,aAAa,CAAC;YACzB,CAAC,CAAC,CAAC;YACH,MAAM;SACT;QACD,KAAK,yBAAyB,CAAC,CAAC;YAC5B,cAAc,GAAG,QAAQ,CAA8D,CAAC,aAAa,EAAE,EAAE;gBACrG,aAAa,CAAC,MAAM,GAAG,aAAa,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,KAAY,EAAE,EAAE,CAAC,CACjE;oBACI,OAAO,EAAE,KAAK,CAAC,OAAO;oBACtB,aAAa,EAAE,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC;iBACpC,CACJ,CAAC,CAAC;gBACH,OAAO,aAAa,CAAC;YACzB,CAAC,CAAC,CAAC;YACH,MAAM;SACT;KAEJ;IAED,OAAO,cAAc,CAAC;AAC1B,CAAC;AAzID,wCAyIC;AAED,SAAS,iBAAiB,CAAC,WAA0B;IACjD,WAAW,KAAK,EAAE,CAAC;IAEnB,MAAM,cAAc,GAAwB;QACxC,MAAM,EAAE,WAAW,CAAC,MAAM,EAAE,QAAQ,EAAE;QACtC,MAAM,EAAE,WAAW,CAAC,MAAM,EAAE,QAAQ,EAAE;QACtC,QAAQ,EAAE,WAAW,CAAC,QAAQ,KAAK,EAAE,CAAC,CAAC,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC,CAAC,SAAS;QACxE,QAAQ,EAAE,WAAW,CAAC,QAAQ,KAAK,EAAE,CAAC,CAAC,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC,CAAC,SAAS;QACxE,iBAAiB,EAAE,yBAAyB,CAAC,WAAW,CAAC,cAAc,EAAE,GAAG,CAAC;QAC7E,UAAU,EAAE,WAAW,CAAC,UAAU,EAAE,YAAY;QAChD,UAAU,EAAE,SAAS,CAAC,WAAW,CAAC,MAAM,CAAC;QACzC,cAAc,EAAE,WAAW,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,EAAE,UAAU,IAAI,CAAC,CAAC;QAClE,WAAW,EAAE;YACT,UAAU,EAAE,WAAW,CAAC,UAAU,EAAE,QAAQ,EAAE;YAC9C,cAAc,EAAE,WAAW,CAAC,cAAc;YAC1C,kBAAkB,EAAE,WAAW,CAAC,cAAc,EAAE,GAAG;SACtD;KACJ,CAAC;IAEF,IAAI,WAAW,CAAC,UAAU,EAAE;QACxB,cAAc,CAAC,UAAU,GAAG;YACxB,cAAc,EAAE,WAAW,CAAC,UAAU,CAAC,cAAc;YACrD,aAAa,EAAE,WAAW,CAAC,UAAU,CAAC,aAAa;YACnD,YAAY,EAAE,WAAW,CAAC,UAAU,CAAC,YAAY;YACjD,UAAU,EAAE,WAAW,CAAC,UAAU,CAAC,UAAU;SAChD,CAAC;KACL;IAED,cAAc,CAAC,WAAW,GAAG,cAAc,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,CAAC,cAAc,KAAK,CAAC,CAAC,CAAC;IACrJ,cAAc,CAAC,WAAW,GAAG,cAAc,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC,CAAC;IACxH,cAAc,CAAC,YAAY,GAAG,cAAc,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,GAAG,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,CAAC,cAAc,KAAK,CAAC,IAAI,CAAC,CAAC,cAAc,KAAK,CAAC,CAAC,CAAC;IAC1K,cAAc,CAAC,aAAa;QACxB,cAAc,CAAC,UAAU;aACpB,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,GAAG,CAAC,QAAQ,CAAC,uBAAuB,CAAC,CAAC;YAC9D,EAAE,GAAG,CAAC,KAAK,CAAC,yCAAyC,CAAC;YACtD,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC;IAEjC,cAAc,CAAC,WAAW,GAAG,cAAc,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,cAAc,KAAK,CAAC,CAAC,EAAE,KAAK,IAAI,CAAC,CAAC,CAAC,2BAA2B;IACnI,cAAc,CAAC,eAAe,GAAG,cAAc,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,cAAc,KAAK,EAAE,CAAC,EAAE,KAAK,IAAI,CAAC,CAAC,CAAC,sBAAsB;IAEnI,OAAO,cAAc,CAAC;AAC1B,CAAC;AAED,SAAgB,kBAAkB,CAAC,KAAK;IACpC,IAAI,KAAK,CAAC,KAAK;QAAE,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;IACtD,IAAI,KAAK,CAAC,UAAU;QAAE,KAAK,CAAC,UAAU,GAAG,KAAK,CAAC,UAAU,CAAC,QAAQ,EAAE,CAAC;IACrE,OAAO,KAAK,CAAC;AACjB,CAAC;AAJD,gDAIC;AAED,SAAgB,sBAAsB,CAAC,UAAU;IAC7C,OAAO,UAAU,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,EAAE;QAC7B,OAAO;YACH,IAAI,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,iBAAiB,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI;YACzD,SAAS,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;SAC/D,CAAC;IACN,CAAC,CAAC,CAAC;AACP,CAAC;AAPD,wDAOC;AAED,SAAgB,SAAS,CAAC,MAAM;IAC5B,IAAI,gBAAgB,GAAG,EAAE,CAAC;IAE1B,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE;QACvB,MAAM,CAAC,OAAO,CAAC,CAAC,WAAW,EAAE,EAAE;YAC3B,IAAI,cAAc,GAAG,WAAW,CAAC,cAAc,CAAC;YAEhD,IAAI,KAAK,CAAC,OAAO,CAAC,WAAW,CAAC,MAAM,CAAC,EAAE;gBACnC,WAAW,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,EAAE;oBACjC,gBAAgB,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,cAAc,EAAE,EAAE,KAAK,CAAC,CAAC,CAAC;gBACpE,CAAC,CAAC,CAAC;aACN;YAED,IAAI,KAAK,CAAC,OAAO,CAAC,WAAW,CAAC,WAAW,CAAC,EAAE;gBACxC,WAAW,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,EAAE;oBACtC,IAAI,KAAK,IAAI,KAAK,CAAC,KAAK,IAAI,KAAK,CAAC,KAAK,CAAC,GAAG,EAAE;wBACzC,gBAAgB,CAAC,IAAI,CAAC;4BAClB,IAAI,EAAE,OAAO;4BACb,cAAc;4BACd,WAAW,EAAE,KAAK,CAAC,WAAW;4BAC9B,GAAG,EAAE,KAAK,CAAC,KAAK,CAAC,GAAG;yBACvB,CAAC,CAAC;qBACN;gBACL,CAAC,CAAC,CAAC;aACN;YAED,IAAI,WAAW,CAAC,iBAAiB,EAAE,KAAK,IAAI,WAAW,CAAC,iBAAiB,EAAE,KAAK,KAAK,GAAG,EAAE;gBACtF,gBAAgB,CAAC,IAAI,CAAC;oBAClB,IAAI,EAAE,WAAW;oBACjB,WAAW,EAAE,WAAW,CAAC,iBAAiB,CAAC,WAAW;oBACtD,KAAK,EAAE,QAAQ,CAAC,WAAW,CAAC,iBAAiB,CAAC,KAAK,CAAC;oBACpD,cAAc,EAAE,WAAW,CAAC,cAAc;iBAC7C,CAAC,CAAC;aACN;QACL,CAAC,CAAC,CAAC;KACN;IAED,OAAO,gBAAgB,CAAC;AAC5B,CAAC;AAtCD,8BAsCC;AAED,SAAgB,yBAAyB,CAAC,WAAW;IACjD,IAAI,CAAC,WAAW,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE;QACpE,OAAO,IAAI,CAAC;KACf;IAED,OAAO,CACH,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;QACrE,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;QACrE,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QAC9C,WAAW,CAAC,CAAC,CAAC,CACjB,CAAC;AACN,CAAC;AAXD,8DAWC","sourcesContent":["import {\r\n    CommonMessageData,\r\n    Emote,\r\n    User,\r\n    WebcastChatMessage,\r\n    WebcastEmoteChatMessage,\r\n    WebcastEventMessage,\r\n    WebcastGiftMessage,\r\n    WebcastLinkMicBattle,\r\n    WebcastQuestionNewMessage,\r\n    WebcastRoomUserSeqMessage,\r\n    WebcastSubEmote\r\n} from '@/types';\r\n\r\n\r\n/**\r\n * This ugly function brings the nested protobuf objects to a flat level\r\n * In addition, attributes in \"Long\" format are converted to strings (e.g. UserIds)\r\n * This makes it easier to handle the data later, since some libraries have problems to serialize this protobuf specific data.\r\n */\r\nexport function simplifyObject(\r\n    type: keyof WebcastEventMessage,\r\n    originalObject: any\r\n): WebcastEventMessage & Record<string, any> {\r\n\r\n    // Utility function for modifying types easily\r\n    const simplify = <T extends any>(fn: (object: T & Record<string, any>) => any): T & Record<string, any> => fn(originalObject as T);\r\n\r\n    if (originalObject.user) {\r\n        originalObject = simplify<{ user: User }>((webcastObject) => {\r\n            Object.assign(webcastObject, getUserAttributes(webcastObject.user));\r\n            delete webcastObject.user;\r\n            return webcastObject;\r\n        });\r\n    }\r\n\r\n    if (originalObject.common) {\r\n        originalObject = simplify<{ common: CommonMessageData }>((webcastObject) => {\r\n            Object.assign(webcastObject, webcastObject.common.displayText);\r\n            delete webcastObject.common.displayText;\r\n            Object.assign(webcastObject, webcastObject.common);\r\n            delete webcastObject.common;\r\n            return webcastObject;\r\n        });\r\n    }\r\n\r\n    switch (type) {\r\n        case 'WebcastQuestionNewMessage': {\r\n            originalObject = simplify<WebcastQuestionNewMessage>((webcastObject) => {\r\n                Object.assign(webcastObject, webcastObject.details);\r\n                delete webcastObject.details;\r\n                return webcastObject;\r\n            });\r\n            break;\r\n        }\r\n        case 'WebcastRoomUserSeqMessage': {\r\n            originalObject = simplify<WebcastRoomUserSeqMessage>((webcastObject) => {\r\n                webcastObject.topViewers = getTopViewerAttributes(webcastObject.ranksList);\r\n                delete webcastObject.ranksList;\r\n                return webcastObject;\r\n            });\r\n            break;\r\n        }\r\n        case 'WebcastLinkMicBattle': {\r\n            originalObject = simplify<WebcastLinkMicBattle>((webcastObject) => {\r\n                const battleUsers = [];\r\n\r\n                Object.values(webcastObject.anchorInfo).forEach((anchor) => {\r\n                    if (anchor.user) {\r\n                        battleUsers.push(getUserAttributes(anchor.user));\r\n                    }\r\n                });\r\n\r\n                webcastObject.battleUsers = battleUsers;\r\n                return webcastObject;\r\n            });\r\n            break;\r\n        }\r\n        case 'WebcastGiftMessage': {\r\n            originalObject = simplify<WebcastGiftMessage & { repeatEnd: any }>((webcastObject) => {\r\n                webcastObject.repeatEnd = !!webcastObject.repeatEnd;\r\n\r\n                // Add previously used JSON structure (for compatibility reasons)\r\n                // Can be removed soon <-- Will it ever be?\r\n                webcastObject.gift = {\r\n                    gift_id: webcastObject.giftId,\r\n                    repeat_count: webcastObject.repeatCount,\r\n                    repeat_end: webcastObject.repeatEnd ? 1 : 0,\r\n                    gift_type: webcastObject.giftDetails?.giftType\r\n                };\r\n\r\n                if (webcastObject.giftDetails) {\r\n                    Object.assign(webcastObject, webcastObject.giftDetails);\r\n                    delete webcastObject.giftDetails;\r\n                }\r\n\r\n                if (webcastObject.giftDetails.giftImage) {\r\n                    Object.assign(webcastObject, webcastObject.giftDetails.giftImage);\r\n                    delete webcastObject.giftDetails.giftImage;\r\n                }\r\n\r\n                if (webcastObject.giftExtra) {\r\n\r\n                    if (webcastObject.giftExtra.toUserId) {\r\n                        webcastObject.receiverUserId = webcastObject.giftExtra.toUserId;\r\n                        delete webcastObject.giftExtra.toUserId;\r\n                    }\r\n\r\n                    if (webcastObject.giftExtra.sendGiftSendMessageSuccessMs) {\r\n                        webcastObject.timestamp = parseInt(webcastObject.giftExtra.sendGiftSendMessageSuccessMs);\r\n                        delete webcastObject.giftExtra.sendGiftSendMessageSuccessMs;\r\n                    }\r\n\r\n                    Object.assign(webcastObject, webcastObject.giftExtra);\r\n                    delete webcastObject.giftExtra;\r\n                }\r\n\r\n                if (webcastObject.monitorExtra?.indexOf('{') === 0) {\r\n                    try {\r\n                        webcastObject.monitorExtra = JSON.parse(webcastObject.monitorExtra);\r\n                    } catch (err) {\r\n                    }\r\n                }\r\n\r\n                return webcastObject;\r\n            });\r\n            break;\r\n        }\r\n        case 'WebcastChatMessage': {\r\n            originalObject = simplify<WebcastChatMessage & { emotes: WebcastSubEmote & any }>((webcastObject) => {\r\n                webcastObject.emotes = webcastObject.emotes.map((emote: WebcastSubEmote) => (\r\n                    {\r\n                        emoteId: emote.emote.emoteId,\r\n                        emoteImageUrl: emote.emote.image.imageUrl,\r\n                        placeInComment: emote.placeInComment\r\n                    }\r\n                ));\r\n                return webcastObject;\r\n            });\r\n            break;\r\n        }\r\n        case 'WebcastEmoteChatMessage': {\r\n            originalObject = simplify<WebcastEmoteChatMessage & { emotes: WebcastSubEmote & any }>((webcastObject) => {\r\n                webcastObject.emotes = webcastObject.emoteList.map((emote: Emote) => (\r\n                    {\r\n                        emoteId: emote.emoteId,\r\n                        emoteImageUrl: emote.image.url[0]\r\n                    }\r\n                ));\r\n                return webcastObject;\r\n            });\r\n            break;\r\n        }\r\n\r\n    }\r\n\r\n    return originalObject;\r\n}\r\n\r\nfunction getUserAttributes(webcastUser: Partial<User>): Record<string, any> {\r\n    webcastUser ||= {};\r\n\r\n    const userAttributes: Record<string, any> = {\r\n        userId: webcastUser.userId?.toString(),\r\n        secUid: webcastUser.secUid?.toString(),\r\n        uniqueId: webcastUser.uniqueId !== '' ? webcastUser.uniqueId : undefined,\r\n        nickname: webcastUser.nickname !== '' ? webcastUser.nickname : undefined,\r\n        profilePictureUrl: getPreferredPictureFormat(webcastUser.profilePicture?.url),\r\n        followRole: webcastUser.followInfo?.followStatus,\r\n        userBadges: mapBadges(webcastUser.badges), // todo fix struct\r\n        userSceneTypes: webcastUser.badges?.map((x) => x?.badgeScene || 0),\r\n        userDetails: {\r\n            createTime: webcastUser.createTime?.toString(),\r\n            bioDescription: webcastUser.bioDescription,\r\n            profilePictureUrls: webcastUser.profilePicture?.url\r\n        }\r\n    };\r\n\r\n    if (webcastUser.followInfo) {\r\n        userAttributes.followInfo = {\r\n            followingCount: webcastUser.followInfo.followingCount,\r\n            followerCount: webcastUser.followInfo.followerCount,\r\n            followStatus: webcastUser.followInfo.followStatus,\r\n            pushStatus: webcastUser.followInfo.pushStatus\r\n        };\r\n    }\r\n\r\n    userAttributes.isModerator = userAttributes.userBadges.some((x) => (x.type && x.type.toLowerCase().includes('moderator')) || x.badgeSceneType === 1);\r\n    userAttributes.isNewGifter = userAttributes.userBadges.some((x) => x.type && x.type.toLowerCase().includes('live_ng_'));\r\n    userAttributes.isSubscriber = userAttributes.userBadges.some((x) => (x.url && x.url.toLowerCase().includes('/sub_')) || x.badgeSceneType === 4 || x.badgeSceneType === 7);\r\n    userAttributes.topGifterRank =\r\n        userAttributes.userBadges\r\n            .find((x) => x.url && x.url.includes('/ranklist_top_gifter_'))\r\n            ?.url.match(/(?<=ranklist_top_gifter_)(\\d+)(?=.png)/g)\r\n            ?.map(Number)[0] ?? null;\r\n\r\n    userAttributes.gifterLevel = userAttributes.userBadges.find((x) => x.badgeSceneType === 8)?.level || 0; // BadgeSceneType_UserGrade\r\n    userAttributes.teamMemberLevel = userAttributes.userBadges.find((x) => x.badgeSceneType === 10)?.level || 0; // BadgeSceneType_Fans\r\n\r\n    return userAttributes;\r\n}\r\n\r\nexport function getEventAttributes(event) {\r\n    if (event.msgId) event.msgId = event.msgId.toString();\r\n    if (event.createTime) event.createTime = event.createTime.toString();\r\n    return event;\r\n}\r\n\r\nexport function getTopViewerAttributes(topViewers) {\r\n    return topViewers.map((viewer) => {\r\n        return {\r\n            user: viewer.user ? getUserAttributes(viewer.user) : null,\r\n            coinCount: viewer.coinCount ? parseInt(viewer.coinCount) : 0\r\n        };\r\n    });\r\n}\r\n\r\nexport function mapBadges(badges) {\r\n    let simplifiedBadges = [];\r\n\r\n    if (Array.isArray(badges)) {\r\n        badges.forEach((innerBadges) => {\r\n            let badgeSceneType = innerBadges.badgeSceneType;\r\n\r\n            if (Array.isArray(innerBadges.badges)) {\r\n                innerBadges.badges.forEach((badge) => {\r\n                    simplifiedBadges.push(Object.assign({ badgeSceneType }, badge));\r\n                });\r\n            }\r\n\r\n            if (Array.isArray(innerBadges.imageBadges)) {\r\n                innerBadges.imageBadges.forEach((badge) => {\r\n                    if (badge && badge.image && badge.image.url) {\r\n                        simplifiedBadges.push({\r\n                            type: 'image',\r\n                            badgeSceneType,\r\n                            displayType: badge.displayType,\r\n                            url: badge.image.url\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n\r\n            if (innerBadges.privilegeLogExtra?.level && innerBadges.privilegeLogExtra?.level !== '0') {\r\n                simplifiedBadges.push({\r\n                    type: 'privilege',\r\n                    privilegeId: innerBadges.privilegeLogExtra.privilegeId,\r\n                    level: parseInt(innerBadges.privilegeLogExtra.level),\r\n                    badgeSceneType: innerBadges.badgeSceneType\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    return simplifiedBadges;\r\n}\r\n\r\nexport function getPreferredPictureFormat(pictureUrls) {\r\n    if (!pictureUrls || !Array.isArray(pictureUrls) || !pictureUrls.length) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        pictureUrls.find((x) => x.includes('100x100') && x.includes('.webp')) ||\r\n        pictureUrls.find((x) => x.includes('100x100') && x.includes('.jpeg')) ||\r\n        pictureUrls.find((x) => !x.includes('shrink')) ||\r\n        pictureUrls[0]\r\n    );\r\n}\r\n\r\n"]}